(()=>{var e={7:e=>{"use strict";var t,r="object"===typeof Reflect?Reflect:null,n=r&&"function"===typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"===typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!==e};function i(){i.init.call(this)}e.exports=i,e.exports.once=function(e,t){return new Promise(function(r,n){function o(r){e.removeListener(t,i),n(r)}function i(){"function"===typeof e.removeListener&&e.removeListener("error",o),r([].slice.call(arguments))}h(e,t,i,{once:!0}),"error"!==t&&function(e,t,r){"function"===typeof e.on&&h(e,"error",t,r)}(e,o,{once:!0})})},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function u(e,t,r,n){var o,i,s,u;if(a(r),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),s=i[t]),void 0===s)s=i[t]=r,++e._eventsCount;else if("function"===typeof s?s=i[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(o=c(e))>0&&s.length>o&&!s.warned){s.warned=!0;var p=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");p.name="MaxListenersExceededWarning",p.emitter=e,p.type=t,p.count=s.length,u=p,console&&console.warn&&console.warn(u)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},o=p.bind(n);return o.listener=r,n.wrapFn=o,o}function m(e,t,r){var n=e._events;if(void 0===n)return[];var o=n[t];return void 0===o?[]:"function"===typeof o?r?[o.listener||o]:[o]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(o):l(o,o.length)}function f(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"===typeof r)return 1;if(void 0!==r)return r.length}return 0}function l(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function h(e,t,r,n){if("function"===typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,function o(i){n.once&&e.removeEventListener(t,o),r(i)})}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!==typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return c(this)},i.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var o="error"===e,i=this._events;if(void 0!==i)o=o&&void 0===i.error;else if(!o)return!1;if(o){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=i[e];if(void 0===c)return!1;if("function"===typeof c)n(c,this,t);else{var u=c.length,p=l(c,u);for(r=0;r<u;++r)n(p[r],this,t)}return!0},i.prototype.addListener=function(e,t){return u(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return u(this,e,t,!0)},i.prototype.once=function(e,t){return a(t),this.on(e,d(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,d(this,e,t)),this},i.prototype.removeListener=function(e,t){var r,n,o,i,s;if(a(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!==typeof r){for(o=-1,i=r.length-1;i>=0;i--)if(r[i]===t||r[i].listener===t){s=r[i].listener,o=i;break}if(o<0)return this;0===o?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,o),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var o,i=Object.keys(r);for(n=0;n<i.length;++n)"removeListener"!==(o=i[n])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},i.prototype.listeners=function(e){return m(this,e,!0)},i.prototype.rawListeners=function(e){return m(this,e,!1)},i.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},i.prototype.listenerCount=f,i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},20:(e,t,r)=>{var n=function(e){return String(Number(e))===e?Number(e):e},o=function(e,t,r){var o=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:o&&!t[e.name]&&(t[e.name]={});var i=e.push?{}:o?t[e.name]:t;!function(e,t,r,o){if(o&&!r)t[o]=n(e[1]);else for(var i=0;i<r.length;i+=1)null!=e[i+1]&&(t[r[i]]=n(e[i+1]))}(r.match(e.reg),i,e.names,e.name),e.push&&t[e.push].push(i)},i=r(602),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);t.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(s).forEach(function(e){var t=e[0],s=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var a=0;a<(i[t]||[]).length;a+=1){var c=i[t][a];if(c.reg.test(s))return o(c,n,s)}}),t.media=r,t};var a=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=n(r[1]):1===r.length&&t.length>1&&(e[r[0]]=void 0),e};t.parseParams=function(e){return e.split(/;\s?/).reduce(a,{})},t.parseFmtpConfig=t.parseParams,t.parsePayloads=function(e){return e.toString().split(" ").map(Number)},t.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),o=0;o<r.length;o+=3)t.push({component:r[o],ip:r[o+1],port:r[o+2]});return t},t.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(a,{})})},t.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})}},363:(e,t,r)=>{var n=r(20),o=r(804);r(602),t.M9=o,t.qg=n.parse,n.parseParams,n.parseFmtpConfig,n.parsePayloads,n.parseRemoteCandidates,n.parseImageAttributes,n.parseSimulcastStreamList},602:e=>{var t=e.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(t).forEach(function(e){t[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},804:(e,t,r)=>{var n=r(602),o=/%[sdv%]/g,i=function(e){var t=1,r=arguments,n=r.length;return e.replace(o,function(e){if(t>=n)return e;var o=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(o);case"%d":return Number(o);case"%v":return""}})},s=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var s=t.names[o];t.name?n.push(r[t.name][s]):n.push(r[t.names[o]])}else n.push(r[t.name]);return i.apply(null,n)},a=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];e.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||a,o=t.innerOrder||c,i=[];return r.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?i.push(s(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){i.push(s(t,r,e))})})}),e.media.forEach(function(e){i.push(s("m",n.m[0],e)),o.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?i.push(s(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){i.push(s(t,r,e))})})})}),i.join("\r\n")+"\r\n"}}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}(()=>{"use strict";var e=r(7),t=r(363);function n(e,t){return n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(e,t)}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function i(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s=function(){function e(){}var t=e.prototype;return t.sendOffer=function(e,t,r){return fetch(e,{method:"POST",headers:{"Content-Type":"application/sdp",Authorization:t},body:r})},t.getConfiguration=function(e,t){return fetch(e,{method:"OPTIONS",headers:{Authorization:t}})},t.delete=function(e){return fetch(e,{method:"DELETE"})},t.updateIce=function(e,t,r){return fetch(e,{method:"PATCH",headers:{"Content-Type":"application/trickle-ice-sdpfrag",ETag:t},body:r})},e}(),a=function(e){var r,o;function a(t){var r,n=t.endpoint,o=t.opts,i=t.whipProtocol,a=t.peerConnectionFactory;return(r=e.call(this)||this).whipEndpoint=void 0,r.opts=void 0,r.peer=void 0,r.resource=void 0,r.eTag=void 0,r.extensions=void 0,r.resourceResolve=void 0,r.iceCredentials=void 0,r.mediaMids=[],r.whipProtocol=void 0,r.peerConnectionFactory=void 0,r.iceGatheringTimeout=void 0,r.waitingForCandidates=!1,r.whipEndpoint=new URL(n),r.opts=o,r.opts.noTrickleIce=!!o.noTrickleIce,r.whipProtocol=i||new s,r.peerConnectionFactory=a||function(e){return new RTCPeerConnection(e)},r.initPeer(),r}o=e,(r=a).prototype=Object.create(o.prototype),r.prototype.constructor=r,n(r,o);var c=a.prototype;return c.initPeer=function(){this.peer=this.peerConnectionFactory({iceServers:this.opts.iceServers||[{urls:["stun:stun.l.google.com:19302"]}]}),this.peer.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange.bind(this)),this.peer.addEventListener("icecandidateerror",this.onIceCandidateError.bind(this)),this.peer.addEventListener("connectionstatechange",this.onConnectionStateChange.bind(this)),this.peer.addEventListener("icecandidate",this.onIceCandidate.bind(this)),this.peer.addEventListener("onicegatheringstatechange",this.onIceGatheringStateChange.bind(this))},c.log=function(){var e;this.opts.debug&&(e=console).log.apply(e,["WHIPClient"].concat([].slice.call(arguments)))},c.error=function(){var e;(e=console).error.apply(e,["WHIPClient"].concat([].slice.call(arguments)))},c.makeSDPTransformCandidate=function(e){var t;return{foundation:e.foundation,component:"rtp"===e.component?0:1,transport:e.protocol.toString(),priority:e.priority,ip:e.address,port:e.port,type:e.type.toString(),raddr:null==e?void 0:e.relatedAddress,rport:null==e?void 0:e.relatedPort,tcptype:null==e||null==(t=e.tcpType)?void 0:t.toString()}},c.makeTrickleIceSdpFragment=function(e){if(this.iceCredentials&&0!==this.mediaMids.length){for(var r,n={media:[],iceUfrag:this.iceCredentials.ufrag,icePwd:this.iceCredentials.pwd},o=i(this.mediaMids);!(r=o()).done;){var s={type:"audio",port:9,protocol:"RTP/AVP",payloads:"0",rtp:[],fmtp:[],mid:r.value,candidates:[this.makeSDPTransformCandidate(e)]};n.media.push(s)}return(0,t.M9)(n).replace("v=0\r\ns= \r\n","")}this.error("Missing local SDP meta data, cannot send trickle ICE candidate")},c.onIceCandidate=function(e){try{var t=this;if("icecandidate"!==e.type)return Promise.resolve();var r=e.candidate;return r?Promise.resolve(function(){if(t.supportTrickleIce()){var e=t.makeTrickleIceSdpFragment(r);return Promise.resolve(t.getResourceUrl()).then(function(r){return Promise.resolve(t.whipProtocol.updateIce(r,t.eTag,e)).then(function(e){e.ok||(t.log("Trickle ICE not supported by endpoint"),t.opts.noTrickleIce=!0)})})}t.log(r.candidate)}()):Promise.resolve()}catch(e){return Promise.reject(e)}},c.onConnectionStateChange=function(e){try{var t=this;t.log("PeerConnectionState",t.peer.connectionState);var r=function(){if("failed"===t.peer.connectionState)return Promise.resolve(t.destroy()).then(function(){})}();return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},c.onIceConnectionStateChange=function(e){this.log("IceConnectionState",this.peer.iceConnectionState)},c.onIceCandidateError=function(e){this.log("IceCandidateError",e)},c.onIceGatheringStateChange=function(e){"complete"===this.peer.iceGatheringState&&!this.supportTrickleIce()&&this.waitingForCandidates&&this.onDoneWaitingForCandidates()},c.getICEConnectionState=function(){return this.peer.iceConnectionState},c.startSdpExchange=function(){try{var e=this;return Promise.resolve(e.peer.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!1})).then(function(r){var n=r.sdp&&(0,t.qg)(r.sdp);if(!n)return Promise.reject();n.iceUfrag&&n.icePwd?e.iceCredentials={pwd:n.icePwd,ufrag:n.iceUfrag}:0!==n.media.length&&n.media[0].iceUfrag&&n.media[0].icePwd&&(e.iceCredentials={pwd:n.media[0].icePwd,ufrag:n.media[0].iceUfrag});for(var o,s=i(n.media);!(o=s()).done;){var a=o.value;a.mid&&e.mediaMids.push(a.mid)}return Promise.resolve(e.peer.setLocalDescription(r)).then(function(){var t=function(){if(e.supportTrickleIce())return Promise.resolve(e.sendOffer()).then(function(){});var t;e.waitingForCandidates=!0,e.iceGatheringTimeout=setTimeout(e.onIceGatheringTimeout.bind(e),(null==(t=e.opts)?void 0:t.timeout)||2e3)}();if(t&&t.then)return t.then(function(){})})})}catch(e){return Promise.reject(e)}},c.onIceGatheringTimeout=function(){this.log("onIceGatheringTimeout"),!this.supportTrickleIce()&&this.waitingForCandidates&&this.onDoneWaitingForCandidates()},c.onDoneWaitingForCandidates=function(){try{var e=this;return e.waitingForCandidates=!1,clearTimeout(e.iceGatheringTimeout),Promise.resolve(e.sendOffer()).then(function(){})}catch(e){return Promise.reject(e)}},c.sendOffer=function(){try{var e=this;return e.log("Sending offer"),e.log(e.peer.localDescription.sdp),Promise.resolve(e.whipProtocol.sendOffer(e.whipEndpoint.toString(),e.opts.authkey,e.peer.localDescription.sdp)).then(function(t){var r=function(){if(t.ok){e.resource=t.headers.get("Location"),e.resource&&!e.resource.match(/^http/)&&(e.resource=new URL(e.resource,e.whipEndpoint).toString()),e.log("WHIP Resource",e.resource),e.eTag=t.headers.get("ETag"),e.log("eTag",e.eTag);var r=t.headers.get("Link");return e.extensions=r?r.split(",").map(function(e){return e.trimStart()}):[],e.log("WHIP Resource Extensions",e.extensions),e.resourceResolve&&(e.resourceResolve(e.resource),e.resourceResolve=null),Promise.resolve(t.text()).then(function(t){return Promise.resolve(e.peer.setRemoteDescription({type:"answer",sdp:t})).then(function(){})})}var n=e.error,o=t.status;return Promise.resolve(t.text()).then(function(t){n.call(e,"IceCandidate","Failed to setup stream connection with endpoint",o,t)})}();if(r&&r.then)return r.then(function(){})})}catch(e){return Promise.reject(e)}},c.doFetchICEFromEndpoint=function(){try{var e=this,t=[];return Promise.resolve(e.whipProtocol.getConfiguration(e.whipEndpoint.toString(),e.opts.authkey)).then(function(e){return e.ok&&e.headers.forEach(function(e,r){if("link"==r){var n=function(e){var t;if(e.match(/rel="ice-server"/))if(e.match(/^stun:/)){var r=e.match(/^(stun:\S+);/)[1];r&&(t={urls:r})}else e.match(/^turn:/)&&e.split(";").forEach(function(e){if(e.match(/^turn:/)){var r=e.match(/^(turn:\S+)/);t={urls:r[1]}}else if(e.match(/^\s*username[=:]/)){var n=e.match(/^\s*username[=:]\s*"*([^"]+)/);t.username=n[1]}else if(e.match(/^\s*credential[=:]/)){var o=e.match(/^\s*credential[=:]\s*"*([^"]+)/);t.credential=o[1]}});return t}(e);n&&t.push(n)}}),t})}catch(e){return Promise.reject(e)}},c.supportTrickleIce=function(){return!this.opts.noTrickleIce},c.setIceServersFromEndpoint=function(){try{var e=this,t=function(){if(e.opts.authkey)return e.log("Fetching ICE config from endpoint"),Promise.resolve(e.doFetchICEFromEndpoint()).then(function(t){e.peer.setConfiguration({iceServers:t})});e.error("No authkey is provided so cannot fetch ICE config from endpoint.")}();return Promise.resolve(t&&t.then?t.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},c.ingest=function(e){try{var t=function(){return Promise.resolve(r.startSdpExchange()).then(function(){})},r=this;r.peer||r.initPeer(),e.getTracks().forEach(function(t){return r.peer.addTrack(t,e)});var n=function(){if(!r.opts.noTrickleIce)return Promise.resolve(r.whipProtocol.getConfiguration(r.whipEndpoint.toString(),r.opts.authkey)).then(function(e){var t=!1;e.headers.get("access-control-allow-methods")&&(t=e.headers.get("access-control-allow-methods").split(",").map(function(e){return e.trim()}).includes("PATCH")),t?(r.opts.noTrickleIce=!1,r.log("Endpoint says it supports Trickle ICE as PATCH is an allowed method")):(r.opts.noTrickleIce=!0,r.log("Endpoint does not support Trickle ICE"))})}();return Promise.resolve(n&&n.then?n.then(t):t())}catch(e){return Promise.reject(e)}},c.destroy=function(){try{var e=this;return Promise.resolve(e.getResourceUrl()).then(function(t){return Promise.resolve(e.whipProtocol.delete(t).catch(function(t){return e.error("destroy()",t)})).then(function(){var t=e.peer.getSenders();t&&t.forEach(function(e){e.track.stop()}),e.peer.close(),e.resource=null,e.peer=null})})}catch(e){return Promise.reject(e)}},c.getResourceUrl=function(){var e=this;return this.resource?Promise.resolve(this.resource):new Promise(function(t){e.resourceResolve=t})},c.getResourceExtensions=function(){try{var e=this;return Promise.resolve(e.getResourceUrl()).then(function(){return e.extensions})}catch(e){return Promise.reject(e)}},a}(e.EventEmitter);const c=new a({endpoint:"https://turn.econf.cn:7443/index/api/whip?app=rtc&stream=test&sign=41db35390ddad33f83944f44b8b75ded",opts:{debug:!0,iceServers:[]}}),u=document.getElementById("vstream");navigator.mediaDevices.getUserMedia({video:{width:1280,height:720},audio:!0}).then(e=>{u.srcObject=e,c.ingest(e)})})()})();