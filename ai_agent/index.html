<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="MEINESON,meineson@gmail.com"><title>程序员视角的一个最小AI智能体demo拆解 · MBSTUDIO</title><meta name="description" content="先放源码，非常简单，使用nodejs和原生javascript fetch调用大模型的HTTP接口（使用OpenAI传统chat接口），完成监控摄像头的运营管理的小例子。

注：测试使用的是随便找的一家平台服务商，用的deepseek和minimax模型测试，其它兼容OpenAI接口规范的一样。并且"><meta name="keywords" content="mbstudio,ICT,RCS,Deep Learning,Digital Twin,AIGC"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><meta name="generator" content="Hexo 7.3.0"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">MBSTUDIO</a></h3><div class="description"><p>魔瓶工作室 since 2001 /RCS OS IOT AI DT/</p></div></div></div><ul class="social-links"><li><a href="mailto:meineson@gmail.com"><i class="fa fa-envelope">         </i></a></li><li><a target="_blank" rel="noopener" href="https://weibo.com/meineson"><i class="fa fa-weibo"></i></a></li><li><a target="_blank" rel="noopener" href="http://github.com/meineson"><i class="fa fa-github"></i></a></li></ul><div class="footer"></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/links">友链</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/me.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>程序员视角的一个最小AI智能体demo拆解</a></h3></div><div class="post-content"><p>先放源码，非常简单，使用nodejs和原生javascript fetch调用大模型的HTTP接口（使用OpenAI传统chat接口），完成监控摄像头的运营管理的小例子。</p>
<blockquote>
<p>注：测试使用的是随便找的一家平台服务商，用的deepseek和minimax模型测试，其它兼容OpenAI接口规范的一样。并且这段代码也是另一个编程智能体写的——Visual Studio Code的Copilot免费额度生成。仅作概念讲解，勿无脑照搬。</p>
</blockquote>
<p>其主要逻辑就是：</p>
<ul>
<li>定义给AI调用的工具（用人话给AI描述工具是干什么的，再映射到真实程序是怎样实现的，类似现在大火的Skills但那个要更复杂些）</li>
<li>从命令行输入读取用户输入命令（并记住所有的输入输出的文字，类似会话上下文的概念，实际工程要更复杂）</li>
<li>封装请求通过HTTP接口发给大模型平台（OpenAI定义的事实上的标准API接口格式，虽然它家出了新版本接口） </li>
<li>平台返回大模型生成的文字（或匹配到工具调用参数）</li>
<li>执行工具调用，并将工具的输出归并再发给大模型</li>
<li>多次循环调用工具直到不再需要工具调用</li>
<li>大模型综合分析所有输入和输出得出结论</li>
</ul>
<p>虽然简单，但已经描述清楚一个典型的智能体底下究竟干了什么——利用大模型来理解自然语言的需求输入，再综合分析人和机器的各种输入、输出来得出结果。</p>
<p>大模型不干具体的活，它只是负责分析需求输入，找工具人干活，再拼装零碎的中间输出内容，形成最后输出。妥妥的产品经理是不是，哈哈哈哈……</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line">import &#123; execSync &#125; from &#x27;child_process&#x27;;</span><br><span class="line">import readline from &#x27;readline&#x27;;</span><br><span class="line"></span><br><span class="line">// const MODEL = &quot;minimax/minimax-m2.1&quot;; </span><br><span class="line">const MODEL = &#x27;deepseek/deepseek-v3.2-251201&#x27;;</span><br><span class="line"></span><br><span class="line">const rl = readline.createInterface(&#123;</span><br><span class="line">  input: process.stdin,</span><br><span class="line">  output: process.stdout</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const tools = [</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;type&quot;: &quot;function&quot;,</span><br><span class="line">    &quot;function&quot;: &#123;</span><br><span class="line">      name: &quot;get_cameras&quot;,</span><br><span class="line">      description: &quot;获取所有在线的网络摄像头&quot;,      </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">    &quot;type&quot;: &quot;function&quot;,</span><br><span class="line">    &quot;function&quot;: &#123;</span><br><span class="line">      name: &quot;check_camera&quot;,</span><br><span class="line">      description: &quot;检查输入的指定摄像头的状态&quot;,   </span><br><span class="line">      parameters: &#123;</span><br><span class="line">        type: &quot;object&quot;,</span><br><span class="line">        properties: &#123;</span><br><span class="line">          url: &#123; type: &quot;string&quot;, description: &quot;指定摄像头的RTSP地址&quot; &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        required: [&quot;url&quot;]</span><br><span class="line">      &#125;   </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">let messages = [</span><br><span class="line">  &#123; role: &#x27;system&#x27;, content: &#x27;你是 AI Agent，分析用户意图并决定要调用哪个工具。&#x27; &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">async function runTool(action, params) &#123;</span><br><span class="line">  if (action === &quot;get_cameras&quot;) &#123;    </span><br><span class="line">    // 模拟 API</span><br><span class="line">    const cameras = [</span><br><span class="line">      &#123;id:1, name:&#x27;门口&#x27;, url:&#x27;rtsp://172.21.132.230/url1&#x27;&#125;,</span><br><span class="line">      &#123;id:2, name:&#x27;办公室&#x27;, url:&#x27;rtsp://172.21.132.230:554/rtp/32020000002000000003_32020000001320000020?originTypeStr=rtp_push&#x27;&#125;,</span><br><span class="line">      &#123;id:3, name:&#x27;广场&#x27;, url:&#x27;rtsp://172.21.132.230/url3&#x27;&#125;,</span><br><span class="line">    ];</span><br><span class="line">    let resp = &#x27;&#x27;;</span><br><span class="line">    cameras.forEach(cam =&gt; &#123;</span><br><span class="line">      resp += `摄像头名称：$&#123;cam.name&#125;，编号id:$&#123;cam.id&#125;，RTSP播放地址:$&#123;cam.url&#125;\r\n`;</span><br><span class="line">    &#125;)</span><br><span class="line">    return resp;</span><br><span class="line">  &#125;else if (action === &quot;check_camera&quot;) &#123;    </span><br><span class="line">    const url = params.url;</span><br><span class="line">    console.log(`执行命令：ffplay -loglevel debug &#x27;$&#123;url&#125;&#x27;，3秒钟，并检查输出内容判断是否正常。`);</span><br><span class="line">    try &#123;</span><br><span class="line">      const output = execSync(</span><br><span class="line">        `ffplay -t 3 -loglevel debug -i &#x27;$&#123;url&#125;&#x27;`,</span><br><span class="line">        &#123;</span><br><span class="line">          stdio: [&#x27;ignore&#x27;, &#x27;pipe&#x27;, &#x27;pipe&#x27;], // 捕获 stdout + stderr</span><br><span class="line">          encoding: &#x27;utf8&#x27;,</span><br><span class="line">          timeout: 3000 // 3 秒超时</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">      console.log(&#x27;ffplay output:\n&#x27;, output);</span><br><span class="line">      return &quot;ffplay执行输出：&quot; + output;</span><br><span class="line">    &#125; catch (err) &#123;</span><br><span class="line">      // ffplay 被 Ctrl+C / SIGINT / 超时杀掉时也会走这里</span><br><span class="line">      console.error(&#x27;ffplay exited&#x27;);</span><br><span class="line">      return &quot;ffplay命令执行失败：&quot;+err.stdout?.toString()+err.stderr?.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">  return &quot;未知工具&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">async function sendMessage() &#123;</span><br><span class="line">  while (true) &#123;</span><br><span class="line">    const userInput = await new Promise(resolve =&gt; rl.question(&#x27;用户输入: &#x27;, resolve));</span><br><span class="line">    if (userInput.toLowerCase() === &#x27;exit&#x27;) break;</span><br><span class="line"></span><br><span class="line">    messages.push(&#123; role: &#x27;user&#x27;, content: userInput &#125;);</span><br><span class="line"></span><br><span class="line">    let done = false;</span><br><span class="line">    while (!done) &#123;</span><br><span class="line">      console.log(&quot;ai 请求发送。。\r\n&quot;)</span><br><span class="line"></span><br><span class="line">      const response = await fetch(&#x27;https://api.qnaigc.com/v1/chat/completions&#x27;, &#123;</span><br><span class="line">        method: &#x27;POST&#x27;,</span><br><span class="line">        headers: &#123;</span><br><span class="line">          Authorization: &#x27;Bearer &#x27; + process.env.OPENAI_API_KEY,</span><br><span class="line">          &#x27;Content-Type&#x27;: &#x27;application/json&#x27;</span><br><span class="line">        &#125;,</span><br><span class="line">        body: JSON.stringify(&#123;</span><br><span class="line">          stream: false,</span><br><span class="line">          model: MODEL,</span><br><span class="line">          messages: messages,</span><br><span class="line">          tools: tools,</span><br><span class="line">          tool_choice: &#x27;auto&#x27;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      const data = await response.json();</span><br><span class="line">      if(data.error)&#123;</span><br><span class="line">        console.error(&#x27;Error:&#x27;, data.error);</span><br><span class="line">        break;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      console.log(&quot;token usage:%d&quot;, data.usage?.total_tokens);</span><br><span class="line"></span><br><span class="line">      const message = data.choices[0].message;</span><br><span class="line"></span><br><span class="line">      let aiReply;</span><br><span class="line">      if (message.tool_calls) &#123;</span><br><span class="line">        let toolCall = message.tool_calls[0];</span><br><span class="line">        console.log(toolCall, message.content);</span><br><span class="line">        // 模型选择了工具</span><br><span class="line">        const action = toolCall.function.name;</span><br><span class="line">        const params = JSON.parse(toolCall.function.arguments);</span><br><span class="line">        // 这里可以调用对应工具</span><br><span class="line">        aiReply = await runTool(action, params);</span><br><span class="line">        messages.push(&#123;&quot;role&quot;: &quot;tool&quot;, &quot;tool_call_id&quot;: toolCall.id, &quot;content&quot;: aiReply&#125;)</span><br><span class="line">      &#125;else if (message.content) &#123;</span><br><span class="line">        // 普通文本</span><br><span class="line">        aiReply = message.content;</span><br><span class="line">        console.log(&#x27;AI:&#x27;, aiReply);</span><br><span class="line">      &#125;</span><br><span class="line">      messages.push(&#123;&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: aiReply&#125;)</span><br><span class="line"></span><br><span class="line">      // 检查工具调用</span><br><span class="line">      const toolCalls = message.tool_calls || [];</span><br><span class="line">      if (toolCalls.length === 0) &#123;</span><br><span class="line">        // console.log(&quot;\r\n -----DEBUG------&quot;);</span><br><span class="line">        // messages.forEach((item, i) =&gt; &#123;</span><br><span class="line">        //   console.log(`message $&#123;i&#125;:`, item);</span><br><span class="line">        // &#125;);    </span><br><span class="line">        // console.log(&quot;\r\n -----DEBUG end------&quot;);</span><br><span class="line">      </span><br><span class="line">        console.log(&quot;agent结束，等待下一个指令&quot;)</span><br><span class="line">        done = true;</span><br><span class="line">        break;</span><br><span class="line">      &#125;else&#123;</span><br><span class="line">        console.log(&quot;\r\n------\r\nagent下一步。。。\r\n&quot;)</span><br><span class="line">        messages.push(&#123; role: &#x27;user&#x27;, content: &quot;下一步。&quot; &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  rl.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sendMessage();</span><br></pre></td></tr></table></figure>

<p>实际测试日志，可以清晰看到大模型的思维和决策路线：</p>
<p>它能理解你要干什么，能自动解析任务格式的摄像头数据结构并找到你说的“前台”“办公室”是指的摄像头名称，能理解你工具里定义的检测摄像头状态就是用ffplay去尝试播放一下再看日志输出，能解析出日志里播放状态和播放的视频参数格式。</p>
<p>如果使用传统编码方法，你可能需要定义复杂的正则匹配或者更专业一些的编程技巧（例如：tcp连接探测，rtsp协议分析等等），而AI智能体，可以通过有限的信息综合上下文进行判断，容错性也更高。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line">node test.js </span><br><span class="line">用户输入: 帮我看下办公室摄像头工作正常吗</span><br><span class="line">ai 请求发送。。</span><br><span class="line"></span><br><span class="line">token usage:565</span><br><span class="line">&#123;</span><br><span class="line">  index: 0,</span><br><span class="line">  type: &#x27;function&#x27;,</span><br><span class="line">  id: &#x27;call_dxyjcv62vdedg05gvh2mcg30&#x27;,</span><br><span class="line">  function: &#123; name: &#x27;get_cameras&#x27;, arguments: &#x27;&#123;&#125;&#x27; &#125;</span><br><span class="line">&#125; 我需要帮您检查办公室摄像头的工作状态。不过，要检查特定的摄像头，我需要知道它的RTSP地址。</span><br><span class="line"></span><br><span class="line">您能提供一下办公室摄像头的RTSP地址吗？或者您可以先使用&quot;获取所有在线的网络摄像头&quot;功能来查看当前有哪些摄像头在线，这样我可以帮您找到办公室摄像头对应的地址。</span><br><span class="line"></span><br><span class="line">您希望我：</span><br><span class="line">1. 先获取所有在线摄像头列表，然后您告诉我哪个是办公室摄像头？</span><br><span class="line">2. 还是您直接提供办公室摄像头的RTSP地址？</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">------</span><br><span class="line">agent下一步。。。</span><br><span class="line"></span><br><span class="line">ai 请求发送。。</span><br><span class="line"></span><br><span class="line">token usage:899</span><br><span class="line">&#123;</span><br><span class="line">  index: 0,</span><br><span class="line">  type: &#x27;function&#x27;,</span><br><span class="line">  id: &#x27;call_7a7e429f43c44eb7866c1bce&#x27;,</span><br><span class="line">  function: &#123;</span><br><span class="line">    name: &#x27;check_camera&#x27;,</span><br><span class="line">    arguments: &#x27;&#123;&quot;url&quot;: &quot;rtsp://172.21.132.230:554/rtp/32020000002000000003_32020000001320000020?originTypeStr=rtp_push&quot;&#125;&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; 我来帮您检查办公室摄像头的状态。根据您提供的摄像头列表，办公室摄像头的RTSP地址是：rtsp://172.21.132.230:554/rtp/32020000002000000003_32020000001320000020?originTypeStr=rtp_push</span><br><span class="line"></span><br><span class="line">让我检查一下这个摄像头的状态：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">执行命令：ffplay -loglevel debug &#x27;rtsp://172.21.132.230:554/rtp/32020000002000000003_32020000001320000020?originTypeStr=rtp_push&#x27;，3秒钟，并检查输出内容判断是否正常。</span><br><span class="line">ffplay exited</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line">agent下一步。。。</span><br><span class="line"></span><br><span class="line">ai 请求发送。。</span><br><span class="line"></span><br><span class="line">token usage:18401</span><br><span class="line">AI: 根据之前的摄像头列表和检查结果，办公室摄像头的状态如下：</span><br><span class="line"></span><br><span class="line">**办公室摄像头状态：**</span><br><span class="line">- **摄像头名称**：办公室</span><br><span class="line">- **编号id**：2</span><br><span class="line">- **RTSP播放地址**：rtsp://172.21.132.230:554/rtp/32020000002000000003_32020000001320000020?originTypeStr=rtp_push</span><br><span class="line">- **状态**：**工作正常**</span><br><span class="line"></span><br><span class="line">**检测详情：**</span><br><span class="line">1. 摄像头能够成功连接</span><br><span class="line">2. 视频流格式：H.264 (Main)</span><br><span class="line">3. 分辨率：1280×720</span><br><span class="line">4. 帧率：约25 fps</span><br><span class="line">5. 视频编码正常，能够解码播放</span><br><span class="line"></span><br><span class="line">**其他摄像头状态：**</span><br><span class="line">1. **门口摄像头**（id:1）：RTSP地址：rtsp://172.21.132.230/url1</span><br><span class="line">2. **广场摄像头**（id:3）：RTSP地址：rtsp://172.21.132.230/url3</span><br><span class="line"></span><br><span class="line">**结论：** 办公室摄像头工作正常，视频流稳定可用。如果您需要检查其他摄像头，请告诉我。</span><br><span class="line">agent结束，等待下一个指令</span><br><span class="line">用户输入: 门口的呢</span><br><span class="line">ai 请求发送。。</span><br><span class="line"></span><br><span class="line">token usage:18280</span><br><span class="line">&#123;</span><br><span class="line">  index: 0,</span><br><span class="line">  type: &#x27;function&#x27;,</span><br><span class="line">  id: &#x27;call_28q1ooyzibxvsxx22zbl8062&#x27;,</span><br><span class="line">  function: &#123;</span><br><span class="line">    name: &#x27;check_camera&#x27;,</span><br><span class="line">    arguments: &#x27;&#123;&quot;url&quot;: &quot;rtsp://172.21.132.230/url1&quot;&#125;&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; 我来检查门口摄像头的状态。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">执行命令：ffplay -loglevel debug &#x27;rtsp://172.21.132.230/url1&#x27;，3秒钟，并检查输出内容判断是否正常。</span><br><span class="line">ffplay exited</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line">agent下一步。。。</span><br><span class="line"></span><br><span class="line">ai 请求发送。。</span><br><span class="line"></span><br><span class="line">token usage:22676</span><br><span class="line">AI: 根据检查结果，门口摄像头的状态如下：</span><br><span class="line"></span><br><span class="line">**门口摄像头状态：**</span><br><span class="line">- **摄像头名称**：门口</span><br><span class="line">- **编号id**：1</span><br><span class="line">- **RTSP播放地址**：rtsp://172.21.132.230/url1</span><br><span class="line">- **状态**：**连接失败**</span><br><span class="line"></span><br><span class="line">**检测详情：**</span><br><span class="line">1. 摄像头能够建立TCP连接（成功连接到172.21.132.230:554端口）</span><br><span class="line">2. 但是无法获取有效的视频流数据</span><br><span class="line">3. 连接保持活跃但无视频流响应</span><br><span class="line"></span><br><span class="line">**可能的原因：**</span><br><span class="line">1. RTSP地址可能不正确（url1可能不是有效的流地址）</span><br><span class="line">2. 摄像头可能未正确配置或已关闭</span><br><span class="line">3. 视频流服务可能未启动</span><br><span class="line">4. 权限或认证问题</span><br><span class="line"></span><br><span class="line">**建议检查：**</span><br><span class="line">1. 确认RTSP地址是否正确</span><br><span class="line">2. 检查摄像头硬件是否正常开启</span><br><span class="line">3. 验证摄像头配置</span><br><span class="line">4. 尝试使用其他RTSP客户端连接测试</span><br><span class="line"></span><br><span class="line">**当前摄像头状态总结：**</span><br><span class="line">- ✅ **办公室摄像头**：工作正常（1280×720，25fps）</span><br><span class="line">- ❌ **门口摄像头**：连接失败，需要进一步检查</span><br><span class="line">- **广场摄像头**：尚未检查</span><br><span class="line"></span><br><span class="line">您需要我检查广场摄像头吗？或者需要我提供更详细的故障排查建议？</span><br><span class="line">agent结束，等待下一个指令</span><br><span class="line">用户输入: 广场</span><br><span class="line">ai 请求发送。。</span><br><span class="line"></span><br><span class="line">token usage:22926</span><br><span class="line">&#123;</span><br><span class="line">  index: 0,</span><br><span class="line">  type: &#x27;function&#x27;,</span><br><span class="line">  id: &#x27;call_24132e652d50457494315ffc&#x27;,</span><br><span class="line">  function: &#123;</span><br><span class="line">    name: &#x27;check_camera&#x27;,</span><br><span class="line">    arguments: &#x27;&#123;&quot;url&quot;: &quot;rtsp://172.21.132.230/url3&quot;&#125;&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">执行命令：ffplay -loglevel debug &#x27;rtsp://172.21.132.230/url3&#x27;，3秒钟，并检查输出内容判断是否正常。</span><br><span class="line">ffplay exited</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line">agent下一步。。。</span><br><span class="line"></span><br><span class="line">ai 请求发送。。</span><br><span class="line"></span><br><span class="line">token usage:27281</span><br><span class="line">AI: 根据检查结果，广场摄像头的状态如下：</span><br><span class="line"></span><br><span class="line">**广场摄像头状态：**</span><br><span class="line">- **摄像头名称**：广场</span><br><span class="line">- **编号id**：3</span><br><span class="line">- **RTSP播放地址**：rtsp://172.21.132.230/url3</span><br><span class="line">- **状态**：**连接失败**</span><br><span class="line"></span><br><span class="line">**检测详情：**</span><br><span class="line">1. 摄像头能够建立TCP连接（成功连接到172.21.132.230:554端口）</span><br><span class="line">2. 但是无法获取有效的视频流数据</span><br><span class="line">3. 连接保持活跃但无视频流响应</span><br><span class="line">4. 与门口摄像头的情况类似</span><br><span class="line"></span><br><span class="line">**可能的原因：**</span><br><span class="line">1. RTSP地址可能不正确（url3可能不是有效的流地址）</span><br><span class="line">2. 摄像头可能未正确配置或已关闭</span><br><span class="line">3. 视频流服务可能未启动</span><br><span class="line">4. 权限或认证问题</span><br><span class="line"></span><br><span class="line">**所有摄像头状态总结：**</span><br><span class="line"></span><br><span class="line">| 摄像头 | 状态 | 详细情况 |</span><br><span class="line">|--------|------|----------|</span><br><span class="line">| **办公室摄像头** | ✅ **工作正常** | H.264，1280×720，25fps，视频流畅 |</span><br><span class="line">| **门口摄像头** | ❌ **连接失败** | 能建立TCP连接，但无视频流响应 |</span><br><span class="line">| **广场摄像头** | ❌ **连接失败** | 能建立TCP连接，但无视频流响应 |</span><br><span class="line"></span><br><span class="line">**问题分析：**</span><br><span class="line">1. 办公室摄像头工作正常，说明RTSP服务器本身是正常运行的</span><br><span class="line">2. 门口和广场摄像头连接失败，可能是：</span><br><span class="line">   - RTSP地址配置错误（url1和url3可能不是正确的流路径）</span><br><span class="line">   - 这两个摄像头可能未开启或未正确配置</span><br><span class="line">   - 可能需要特定的流名称或认证信息</span><br><span class="line"></span><br><span class="line">**建议：**</span><br><span class="line">1. 检查门口和广场摄像头的实际RTSP地址是否正确</span><br><span class="line">2. 确认这两个摄像头的硬件状态（是否开启）</span><br><span class="line">3. 检查摄像头的配置参数</span><br><span class="line">4. 可能需要联系系统管理员查看具体的流地址配置</span><br><span class="line"></span><br><span class="line">您需要我提供进一步的故障排查步骤吗？</span><br><span class="line">agent结束，等待下一个指令</span><br><span class="line">用户输入: </span><br><span class="line"></span><br></pre></td></tr></table></figure></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2026-02-03</span><i class="fa fa-tag"></i><a class="tag" href="/tags/技术分析/" title="技术分析">技术分析 </a><a class="tag" href="/tags/程序开发/" title="程序开发">程序开发 </a><a class="tag" href="/tags/AI/" title="AI">AI </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://mbstudio.cn/ai_agent/,MBSTUDIO,程序员视角的一个最小AI智能体demo拆解,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="next pagbuttons"><a class="btn" role="navigation" href="/think_about_ai/" title="2026年了，该打开AI这个盲盒了">下一篇</a></li></ul></div><a id="comments"></a><div id="vcomments" style="margin:0 30px;"></div><script src="/js/av-min.js"></script><script src="/js/Valine.min.js"></script><script>var valine = new Valine({
  el:'#vcomments',
  notify:false || false, 
  verify:true|| false, 
  app_id:'NJ38qTX1M6HwqDECSFibkJnD-gzGzoHsz',
  app_key:'xsgCybaxfNqU9qWtVSa1CsPU',
  placeholder:'谢绝广告。',
  path: window.location.pathname,
  avatar:''
})

</script></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/baidu.js"> </script></body></html>